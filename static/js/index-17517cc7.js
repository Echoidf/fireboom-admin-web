import{d as Z,h as n,aL as B,aX as ee,$ as N,k as le,r as m,M as ae,o as z,c as te,f as O,a as e,w as a,aM as oe,q as i,aN as p,x as u,N as ne,m as P,aO as ie,y as re,ax as h,aP as se}from"./index-6c301b4d.js";import{a as x,c as ue}from"./index-5a5916ae.js";import{m as de}from"./index-adf42357.js";import{_ as T}from"./api.bind.vue_vue_type_script_setup_true_lang-cfc7fa5c.js";import{_ as K}from"./menu.bind.vue_vue_type_script_setup_true_lang-87672711.js";const me={class:"app-container"},pe={class:"search"},ce={class:"dialog-footer"},fe={name:"role",components:{RoleBindApi:T,RoleBindMenu:K}},Ve=Z({...fe,name:"RoleManage",setup(ve){const A=n(B),g=n(B);n(ee);const c=n(!1),D=n([]),k=n(0),d=N({pageNum:1,pageSize:10}),U=n([]),f=N({visible:!1}),r=N({code:"",remark:""}),b=n(),L=N({code:[{required:!0,message:"请输入角色编码",trigger:"blur"}]}),M=n(!1),F=n(!1),V=n();async function v(){c.value=!0;const{error:o,data:l}=await x.query({operationName:"System/Role/GetList",input:ue(d,{containsFields:["code","remark"]})});o||(U.value=l.data,k.value=l.total),c.value=!1}function w(){A.value.resetFields(),d.pageNum=1,v()}function Q(o){D.value=o.map(l=>l.id)}function q(o){f.visible=!0,o?(f.title="修改角色",de(r,o),b.value=o.id):f.title="新增角色"}async function I(){c.value=!0,g.value.validate(async o=>{if(o){if(b.value){const{error:l}=await x.mutate({operationName:"System/Role/UpdateOne",input:{id:b.value,remark:r.remark}});l||(h.success("修改成功"),C(),w())}else{const{error:l}=await x.mutate({operationName:"System/Role/AddOne",input:{...r}});l||(h.success("新增成功"),C(),w())}c.value=!1}})}function C(){f.visible=!1,G()}function G(){g.value.resetFields(),g.value.clearValidate(),r.code="",r.remark=""}function E(o){const l=o?[o]:D;if(!l){h.warning("请勾选删除项");return}se.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{c.value=!0;const{error:_}=await x.mutate({operationName:"System/Role/DeleteMany",input:{ids:l}});_||(h.success("删除成功"),w()),c.value=!1})}function X(o){M.value=!0,V.value=o}function j(o){F.value=!0,V.value=o}return le(()=>{v()}),(o,l)=>{const _=m("el-input"),R=m("el-form-item"),s=m("el-button"),y=m("Auth"),S=m("el-table-column"),H=m("el-table"),J=m("el-card"),W=m("el-dialog"),Y=ae("loading");return z(),te("div",me,[O("div",pe,[e(i(B),{ref_key:"queryFormRef",ref:A,model:d,inline:!0},{default:a(()=>[e(R,{prop:"code",label:"编码"},{default:a(()=>[e(_,{modelValue:d.code,"onUpdate:modelValue":l[0]||(l[0]=t=>d.code=t),placeholder:"角色编码",clearable:"",onKeyup:oe(v,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(R,null,{default:a(()=>[e(s,{type:"primary",onClick:v},{default:a(()=>[e(i(p),{icon:"ep:search"}),u("搜索 ")]),_:1}),e(s,{onClick:w},{default:a(()=>[e(i(p),{icon:"ep:refresh"}),u("重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),e(J,{shadow:"never"},{header:a(()=>[e(y,{value:"/System/Role/AddOne"},{default:a(()=>[e(s,{type:"success",onClick:l[1]||(l[1]=t=>q())},{default:a(()=>[e(i(p),{icon:"ep:plus"}),u("新增 ")]),_:1})]),_:1}),e(y,{value:"/System/Role/DeleteOne"},{default:a(()=>[e(s,{type:"danger",disabled:D.value.length===0,onClick:l[2]||(l[2]=t=>E())},{default:a(()=>[e(i(p),{icon:"ep:delete"}),u("删除 ")]),_:1},8,["disabled"])]),_:1})]),default:a(()=>[ne((z(),P(H,{ref:"dataTableRef",data:U.value,onSelectionChange:Q,"highlight-current-row":"",border:""},{default:a(()=>[e(S,{type:"selection",width:"55",align:"center"}),e(S,{label:"角色编码",prop:"code",width:"200"}),e(S,{label:"角色描述",prop:"remark",width:"300"}),e(S,{fixed:"right",label:"操作"},{default:a(t=>[e(y,{value:"/System/Role/BindRoleApis"},{default:a(()=>[e(s,{type:"primary",size:"small",link:"",onClick:$=>X(t.row)},{default:a(()=>[e(i(p),{icon:"ep:position"}),u("分配权限 ")]),_:2},1032,["onClick"])]),_:2},1024),e(s,{type:"primary",size:"small",link:"",onClick:$=>j(t.row)},{default:a(()=>[e(i(p),{icon:"ep:position"}),u("分配菜单 ")]),_:2},1032,["onClick"]),e(y,{value:"/System/Role/UpdateOne"},{default:a(()=>[e(s,{type:"primary",size:"small",link:"",onClick:$=>q(t.row)},{default:a(()=>[e(i(p),{icon:"ep:edit"}),u("编辑 ")]),_:2},1032,["onClick"])]),_:2},1024),e(y,{value:"/System/Role/DeleteMany"},{default:a(()=>[e(s,{type:"primary",size:"small",link:"",onClick:$=>E(t.row.id)},{default:a(()=>[e(i(p),{icon:"ep:delete"}),u("删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Y,c.value]]),k.value>0?(z(),P(i(ie),{key:0,total:k.value,"onUpdate:total":l[3]||(l[3]=t=>k.value=t),page:d.pageNum,"onUpdate:page":l[4]||(l[4]=t=>d.pageNum=t),limit:d.pageSize,"onUpdate:limit":l[5]||(l[5]=t=>d.pageSize=t),onPagination:v},null,8,["total","page","limit"])):re("",!0)]),_:1}),e(W,{title:f.title,modelValue:f.visible,"onUpdate:modelValue":l[8]||(l[8]=t=>f.visible=t),width:"500px",onClose:C},{footer:a(()=>[O("div",ce,[e(s,{type:"primary",onClick:I},{default:a(()=>[u("确 定")]),_:1}),e(s,{onClick:C},{default:a(()=>[u("取 消")]),_:1})])]),default:a(()=>[e(i(B),{ref_key:"roleFormRef",ref:g,model:r,rules:L,"label-width":"100px"},{default:a(()=>[e(R,{label:"角色编码",prop:"code"},{default:a(()=>[e(_,{modelValue:r.code,"onUpdate:modelValue":l[6]||(l[6]=t=>r.code=t),readonly:!!b.value,placeholder:"请输入角色编码"},null,8,["modelValue","readonly"])]),_:1}),e(R,{label:"角色描述",prop:"remark"},{default:a(()=>[e(_,{modelValue:r.remark,"onUpdate:modelValue":l[7]||(l[7]=t=>r.remark=t),placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(T,{modelValue:M.value,"onUpdate:modelValue":l[9]||(l[9]=t=>M.value=t),role:V.value,roles:U.value},null,8,["modelValue","role","roles"]),e(K,{modelValue:F.value,"onUpdate:modelValue":l[10]||(l[10]=t=>F.value=t),role:V.value},null,8,["modelValue","role"])])}}});export{Ve as default};
