import{d as H,r as b,aw as be,a as i,k as J,c as z,w as u,b as _,f as T,i as e,e as m,m as O,l as y,aP as ve,aF as B,u as pe,a2 as I,o as ce,g as L,aQ as me,aR as fe,az as D,aA as P,aB as R,F as K,h as j,t as $,Z as ge,aC as ye,aI as _e,aS as he,aT as we}from"./index-d0b35c07.js";import{a as q,c as Ce}from"./index-85939620.js";const Se={class:"dialog-footer"},Ve=H({__name:"role.bind",props:{modelValue:{type:Boolean,default:!1},user:{type:Object}},emits:["update:modelValue"],setup(E,{emit:x}){const V=E,M=b(),h=b(!1),k=b([]),U=b([]);let w=[];function F(o){U.value=o.map(v=>v.id)}function f(){x("update:modelValue",!1),h.value=!1,U.value=[],w=[]}async function s(){h.value=!0;for(const o of w)await q.mutate({operationName:"System/User/DisconnectRole",input:{userId:V.user.id,roleId:o}});for(const o of U.value)await q.mutate({operationName:"System/User/ConnectRole",input:{userId:V.user.id,roleId:o}});B.success("绑定完成"),f()}return be(async()=>{if(V.modelValue&&V.user){h.value=!0;const o=await q.query({operationName:"System/Role/GetMany"});if(!o.error){k.value=o.data.data;const{error:v,data:p}=await q.query({operationName:"System/User/GetUserRole",input:{userId:V.user.id}});if(!v){w=p.data.map(C=>C.id)||[],U.value=w;const n=k.value.filter(C=>w.includes(C.id));for(const C of n)M.value.toggleRowSelection(C,!0)}}h.value=!1}}),(o,v)=>{const p=i("el-table-column"),n=i("el-button"),C=i("el-dialog"),G=J("loading");return _(),z(C,{title:"绑定角色","model-value":E.modelValue,width:"600px","append-to-body":"","onUpdate:modelValue":v[0]||(v[0]=N=>o.$emit("update:modelValue",N)),onClose:f},{footer:u(()=>[T("span",Se,[e(n,{onClick:f},{default:u(()=>[m("取消")]),_:1}),e(n,{type:"primary",onClick:s},{default:u(()=>[m("确定")]),_:1})])]),default:u(()=>[O((_(),z(y(ve),{data:k.value,ref_key:"tableRef",ref:M,onSelectionChange:F},{default:u(()=>[e(p,{type:"selection",width:"55",align:"center"}),e(p,{key:"code",label:"Code",align:"center",prop:"code",width:"200"}),e(p,{key:"remark",label:"描述",align:"center",prop:"remark"})]),_:1},8,["data"])),[[G,h.value]])]),_:1},8,["model-value"])}}}),ke=[{label:"热门国家",options:[{value:"China",label:"中国"}]},{label:"所有国家",options:[{value:"Angola",label:"安哥拉"},{value:"Afghanistan",label:"阿富汗"},{value:"Albania",label:"阿尔巴尼亚"},{value:"Algeria",label:"阿尔及利亚"},{value:"Andorra",label:"安道尔共和国"},{value:"Anguilla",label:"安圭拉岛"},{value:"Antigua and Barbuda",label:"安提瓜和巴布达"},{value:"Argentina",label:"阿根廷"},{value:"Armenia",label:"亚美尼亚"},{value:"Ascension",label:"阿森松"},{value:"Australia",label:"澳大利亚"},{value:"Austria",label:"奥地利"},{value:"Azerbaijan",label:"阿塞拜疆"},{value:"Bahamas",label:"巴哈马"},{value:"Bahrain",label:"巴林"},{value:"Bangladesh",label:"孟加拉国"},{value:"Barbados",label:"巴巴多斯"},{value:"Belarus",label:"白俄罗斯"},{value:"Belgium",label:"比利时"},{value:"Belize",label:"伯利兹"},{value:"Benin",label:"贝宁"},{value:"Bermuda Is",label:"百慕大群岛"},{value:"Bolivia",label:"玻利维亚"},{value:"Botswana",label:"博茨瓦纳"},{value:"Brazil",label:"巴西"},{value:"Brunei",label:"文莱"},{value:"Bulgaria",label:"保加利亚"},{value:"Burkina Faso",label:"布基纳法索"},{value:"Burma",label:"缅甸"},{value:"Burundi",label:"布隆迪"},{value:"Cameroon",label:"喀麦隆"},{value:"Canada",label:"加拿大"},{value:"Cayman Is",label:"开曼群岛"},{value:"Central African Republic",label:"中非共和国"},{value:"Chad",label:"乍得"},{value:"Chile",label:"智利"},{value:"China",label:"中国"},{value:"Colombia",label:"哥伦比亚"},{value:"Congo",label:"刚果"},{value:"Cook Is",label:"库克群岛"},{value:"Costa Rica",label:"哥斯达黎加"},{value:"Cuba",label:"古巴"},{value:"Cyprus",label:"塞浦路斯"},{value:"Czech Republic",label:"捷克"},{value:"Denmark",label:"丹麦"},{value:"Djibouti",label:"吉布提"},{value:"Dominica Rep",label:"多米尼加共和国"},{value:"Ecuador",label:"厄瓜多尔"},{value:"Egypt",label:"埃及"},{value:"EI Salvador",label:"萨尔瓦多"},{value:"Estonia",label:"爱沙尼亚"},{value:"Ethiopia",label:"埃塞俄比亚"},{value:"Fiji",label:"斐济"},{value:"Finland",label:"芬兰"},{value:"France",label:"法国"},{value:"French Guiana",label:"法属圭亚那"},{value:"French Polynesia",label:"法属玻利尼西亚"},{value:"Gabon",label:"加蓬"},{value:"Gambia",label:"冈比亚"},{value:"Georgia",label:"格鲁吉亚"},{value:"Germany",label:"德国"},{value:"Ghana",label:"加纳"},{value:"Gibraltar",label:"直布罗陀"},{value:"Greece",label:"希腊"},{value:"Grenada",label:"格林纳达"},{value:"Guam",label:"关岛"},{value:"Guatemala",label:"危地马拉"},{value:"Guinea",label:"几内亚"},{value:"Guyana",label:"圭亚那"},{value:"Haiti",label:"海地"},{value:"Honduras",label:"洪都拉斯"},{value:"Hungary",label:"匈牙利"},{value:"Iceland",label:"冰岛"},{value:"India",label:"印度"},{value:"Indonesia",label:"印度尼西亚"},{value:"Iran",label:"伊朗"},{value:"Iraq",label:"伊拉克"},{value:"Ireland",label:"爱尔兰"},{value:"Israel",label:"以色列"},{value:"Italy",label:"意大利"},{value:"Ivory Coast",label:"科特迪瓦"},{value:"Jamaica",label:"牙买加"},{value:"Japan",label:"日本"},{value:"Jordan",label:"约旦"},{value:"Kampuchea (Cambodia )",label:"柬埔寨"},{value:"Kazakstan",label:"哈萨克斯坦"},{value:"Kenya",label:"肯尼亚"},{value:"Korea",label:"韩国"},{value:"Kuwait",label:"科威特"},{value:"Kyrgyzstan",label:"吉尔吉斯坦"},{value:"Laos",label:"老挝"},{value:"Latvia",label:"拉脱维亚"},{value:"Lebanon",label:"黎巴嫩"},{value:"Lesotho",label:"莱索托"},{value:"Liberia",label:"利比里亚"},{value:"Libya",label:"利比亚"},{value:"Liechtenstein",label:"列支敦士登"},{value:"Lithuania",label:"立陶宛"},{value:"Luxembourg",label:"卢森堡"},{value:"Madagascar",label:"马达加斯加"},{value:"Malawi",label:"马拉维"},{value:"Malaysia",label:"马来西亚"},{value:"Maldives",label:"马尔代夫"},{value:"Mali",label:"马里"},{value:"Malta",label:"马耳他"},{value:"Mariana Is",label:"马里亚那群岛"},{value:"Martinique",label:"马提尼克"},{value:"Mauritius",label:"毛里求斯"},{value:"Mexico",label:"墨西哥"},{value:"Moldova",label:"摩尔多瓦"},{value:"Monaco",label:"摩纳哥"},{value:"Mongolia",label:"蒙古"},{value:"Montserrat Is",label:"蒙特塞拉特岛"},{value:"Morocco",label:"摩洛哥"},{value:"Mozambique",label:"莫桑比克"},{value:"Namibia",label:"纳米比亚"},{value:"Nauru",label:"瑙鲁"},{value:"Nepal",label:"尼泊尔"},{value:"Netheriands Antilles",label:"荷属安的列斯"},{value:"Netherlands",label:"荷兰"},{value:"New Zealand",label:"新西兰"},{value:"Nicaragua",label:"尼加拉瓜"},{value:"Niger",label:"尼日尔"},{value:"Nigeria",label:"尼日利亚"},{value:"North Korea",label:"朝鲜"},{value:"Norway",label:"挪威"},{value:"Oman",label:"阿曼"},{value:"Pakistan",label:"巴基斯坦"},{value:"Panama",label:"巴拿马"},{value:"Papua New Cuinea",label:"巴布亚新几内亚"},{value:"Paraguay",label:"巴拉圭"},{value:"Peru",label:"秘鲁"},{value:"Philippines",label:"菲律宾"},{value:"Poland",label:"波兰"},{value:"Portugal",label:"葡萄牙"},{value:"Puerto Rico",label:"波多黎各"},{value:"Qatar",label:"卡塔尔"},{value:"Reunion",label:"留尼旺"},{value:"Romania",label:"罗马尼亚"},{value:"Russia",label:"俄罗斯"},{value:"Saint Lueia",label:"圣卢西亚"},{value:"Saint Vincent",label:"圣文森特岛"},{value:"Samoa Eastern",label:"东萨摩亚(美)"},{value:"Samoa Western",label:"西萨摩亚"},{value:"San Marino",label:"圣马力诺"},{value:"Sao Tome and Principe",label:"圣多美和普林西比"},{value:"Saudi Arabia",label:"沙特阿拉伯"},{value:"Senegal",label:"塞内加尔"},{value:"Seychelles",label:"塞舌尔"},{value:"Sierra Leone",label:"塞拉利昂"},{value:"Singapore",label:"新加坡"},{value:"Slovakia",label:"斯洛伐克"},{value:"Slovenia",label:"斯洛文尼亚"},{value:"Solomon Is",label:"所罗门群岛"},{value:"Somali",label:"索马里"},{value:"South Africa",label:"南非"},{value:"Spain",label:"西班牙"},{value:"SriLanka",label:"斯里兰卡"},{value:"St.Lucia",label:"圣卢西亚"},{value:"St.Vincent",label:"圣文森特"},{value:"Sudan",label:"苏丹"},{value:"Suriname",label:"苏里南"},{value:"Swaziland",label:"斯威士兰"},{value:"Sweden",label:"瑞典"},{value:"Switzerland",label:"瑞士"},{value:"Syria",label:"叙利亚"},{value:"Tajikstan",label:"塔吉克斯坦"},{value:"Tanzania",label:"坦桑尼亚"},{value:"Thailand",label:"泰国"},{value:"Togo",label:"多哥"},{value:"Tonga",label:"汤加"},{value:"Trinidad and Tobago",label:"特立尼达和多巴哥"},{value:"Tunisia",label:"突尼斯"},{value:"Turkey",label:"土耳其"},{value:"Turkmenistan",label:"土库曼斯坦"},{value:"Uganda",label:"乌干达"},{value:"Ukraine",label:"乌克兰"},{value:"United Arab Emirates",label:"阿拉伯联合酋长国"},{value:"United Kiongdom",label:"英国"},{value:"United States of America",label:"美国"},{value:"Uruguay",label:"乌拉圭"},{value:"Uzbekistan",label:"乌兹别克斯坦"},{value:"Venezuela",label:"委内瑞拉"},{value:"Vietnam",label:"越南"},{value:"Yemen",label:"也门"},{value:"Yugoslavia",label:"南斯拉夫"},{value:"Zimbabwe",label:"津巴布韦"},{value:"Zaire",label:"扎伊尔"},{value:"Zambia",label:"赞比亚"}]}],Ue={class:"app-container"},Be={class:"search"},Me={style:{float:"left"}},Ne={style:{float:"right",color:"#8492a6","font-size":"13px"}},Ae={class:"dialog-footer"},Re=H({name:"UserManage",__name:"index",setup(E){const x=b(D),V=b(D),M=b(!1),h=b(0),k=b(!1),U=b(),w=b(!1),F=pe(),f=I({visible:!1}),s=I({pageNum:1,pageSize:10,name:""}),o=I({id:"",name:"",phone:""}),v=b([]),p=b([]),n=I({countryCode:"",name:"",password:"",passwordType:"",phone:""}),C=I({countryCode:[{required:!0,message:"请选择您的国籍"}],name:[{required:!0,message:"请输入用户名",trigger:["blur"]}],password:[{required:!0,message:"请输入密码",trigger:["blur"]}],passwordType:[{required:!0,message:"请再次输入密码",trigger:["blur"]},{validator:function(r,a,t){a!==n.password?t(new Error("两次密码不一致!")):t()}}],phone:[{required:!0,message:"请输入您的电话号码",trigger:["blur"]},{validator:function(r,a,t){/^\d{11}$/.test(a)?t():t(new Error("电话号码格式错误!"))}}]});function G(r){f.visible=!0,f.title="新增用户"}function N(){f.visible=!1}async function g(){if(M.value=!0,o.name||o.phone||o.id){const r={};for(let a in o)o[a]&&(r[a]=o[a]);me(r).then(a=>{if(a.data.data.main_findUniqueuser){const t=a.data.data.main_findUniqueuser;p.value=a.data.data.main_findManyuser.filter(d=>d.id!==t.id),p.value.unshift(t)}else p.value=a.data.data.main_findManyuser;h.value=p.value.length,v.value=p.value.slice((s.pageNum-1)*s.pageSize,s.pageNum*s.pageSize)}).catch(a=>{B.error("查询失败")})}else{const{error:r,data:a}=await q.query({operationName:"System/User/GetList",input:Ce(s,{containsFields:["name"]})});r||(v.value=a.data,v.value.forEach(t=>{t.roles=t._join.main_findManyrole_user.map(d=>d._join.main_findManyrole[0].code)})),await fe().then(t=>{h.value=t.data.data.main_aggregateuser._count.id})}M.value=!1}function W(){x.value.resetFields(),s.pageNum=1,o.name="",o.phone="",o.id="",g()}function Y(r){F.push({name:"UserUpdateManage",query:{userId:r}})}function X(r){_e.confirm("确定要删除该用户嘛?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{he({id:r}).then(t=>{B.success("删除成功"),g()}).catch(t=>{B.error("删除失败"),g()})}).catch(()=>{B.info("已取消")})}function ee(){n.countryCode="",n.name="",n.password="",n.passwordType="",n.phone=""}async function ae(){V.value.validate(r=>{r&&(w.value=!0,window.setTimeout(()=>{w.value=!1},1e3),we(n).then(a=>{B.success("成功添加一个新用户"),N(),ee(),g()}).catch(a=>{B.error("新增失败"),N()}))})}function le(r){k.value=!0,U.value=r}return ce(()=>{g()}),(r,a)=>{const t=i("el-input"),d=i("el-form-item"),S=i("el-button"),Q=i("Auth"),A=i("el-table-column"),ue=i("Avatar"),oe=i("el-table"),ne=i("el-card"),te=i("el-option"),re=i("el-option-group"),ie=i("el-select"),se=i("el-dialog"),de=J("loading");return _(),L("div",Ue,[T("div",Be,[e(y(D),{ref_key:"queryFormRef",ref:x,model:s,inline:!0},{default:u(()=>[e(d,{label:"用户名",prop:"name"},{default:u(()=>[e(t,{modelValue:o.name,"onUpdate:modelValue":a[0]||(a[0]=l=>o.name=l),placeholder:"请输入用户名:",clearable:"",style:{width:"200px"},onKeyup:P(g,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(d,{label:"电话",prop:"name"},{default:u(()=>[e(t,{modelValue:o.phone,"onUpdate:modelValue":a[1]||(a[1]=l=>o.phone=l),placeholder:"请输入电话:",clearable:"",style:{width:"200px"},onKeyup:P(g,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(d,{label:"用户名",prop:"name"},{default:u(()=>[e(t,{modelValue:o.id,"onUpdate:modelValue":a[2]||(a[2]=l=>o.id=l),placeholder:"请输入用户ID:",clearable:"",style:{width:"200px"},onKeyup:P(g,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(d,null,{default:u(()=>[e(Q,{value:"system:user:query"},{default:u(()=>[e(S,{type:"primary",onClick:g},{default:u(()=>[e(y(R),{icon:"ep:search"}),m("搜索 ")]),_:1})]),_:1}),e(Q,{value:"system:user:query"},{default:u(()=>[e(S,{onClick:W},{default:u(()=>[e(y(R),{icon:"ep:refresh"}),m(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),e(ne,{shadow:"never"},{header:u(()=>[e(S,{type:"success",onClick:a[3]||(a[3]=l=>G())},{default:u(()=>[e(y(R),{icon:"ep:plus"}),m("新增 ")]),_:1})]),default:u(()=>[O((_(),z(oe,{data:v.value,"highlight-current-row":"",border:""},{default:u(()=>[e(A,{key:"id",label:"编号",align:"center",prop:"id",width:"100"}),e(A,{key:"name",label:"用户名",align:"center",prop:"name",width:"200"}),e(A,{label:"头像",width:"80",align:"center",prop:"avatar"},{default:u(l=>[e(ue,{username:l.row.name,src:l.row.avatar,"background-color":"#ccc",color:"#fff",style:{"vertical-align":"middle"},inline:!0},null,8,["username","src"])]),_:1}),e(A,{label:"角色",width:"260",align:"center",prop:"roles"},{default:u(l=>[(_(!0),L(K,null,j(l.row.roles,c=>(_(),z(S,{type:"primary",round:""},{default:u(()=>[m($(c),1)]),_:2},1024))),256))]),_:1}),e(A,{label:"创建时间",align:"center",prop:"createdAt",width:"200",formatter:(l,c,Z)=>Z?new Date(Z).toLocaleDateString():""},null,8,["formatter"]),e(A,{label:"操作",fixed:"right","min-width":"200",align:"center"},{default:u(l=>[e(S,{type:"primary",size:"small",link:"",onClick:c=>le(l.row)},{default:u(()=>[m("绑定角色")]),_:2},1032,["onClick"]),e(S,{type:"primary",size:"small",link:"",onClick:c=>X(l.row.id)},{default:u(()=>[e(y(R),{icon:"ep:delete"}),m("删除 ")]),_:2},1032,["onClick"]),e(S,{size:"small",link:"",type:"primary",onClick:ge(c=>Y(l.row.user_id),["stop"])},{default:u(()=>[e(y(R),{icon:"ep:edit"}),m("修改 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,M.value]]),e(y(ye),{total:h.value,"current-page":s.pageNum,"onUpdate:currentPage":a[4]||(a[4]=l=>s.pageNum=l),"page-size":s.pageSize,"onUpdate:pageSize":a[5]||(a[5]=l=>s.pageSize=l),onCurrentChange:g},null,8,["total","current-page","page-size"])]),_:1}),e(Ve,{modelValue:k.value,"onUpdate:modelValue":a[6]||(a[6]=l=>k.value=l),user:U.value},null,8,["modelValue","user"]),e(se,{title:f.title,modelValue:f.visible,"onUpdate:modelValue":a[12]||(a[12]=l=>f.visible=l),width:"500px",onClose:N},{footer:u(()=>[T("div",Ae,[e(S,{type:"primary",onClick:ae,disabled:w.value},{default:u(()=>[m("确 定")]),_:1},8,["disabled"]),e(S,{onClick:N},{default:u(()=>[m("取 消")]),_:1})])]),default:u(()=>[e(y(D),{ref_key:"roleFormRef",ref:V,model:n,rules:C,"label-width":"100px"},{default:u(()=>[e(d,{label:"国 籍",prop:"countruCode"},{default:u(()=>[e(ie,{placeholder:"请选择国籍",filterable:"",style:{width:"77.9%"},modelValue:n.countryCode,"onUpdate:modelValue":a[7]||(a[7]=l=>n.countryCode=l)},{default:u(()=>[(_(!0),L(K,null,j(y(ke),l=>(_(),z(re,{key:l.label,label:l.label},{default:u(()=>[(_(!0),L(K,null,j(l.options,c=>(_(),z(te,{key:c.value,label:c.label,value:c.label},{default:u(()=>[T("span",Me,$(c.label),1),T("span",Ne,$(c.value),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"用户名",prop:"name"},{default:u(()=>[e(t,{modelValue:n.name,"onUpdate:modelValue":a[8]||(a[8]=l=>n.name=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(d,{label:"密码",prop:"password"},{default:u(()=>[e(t,{type:"password",modelValue:n.password,"onUpdate:modelValue":a[9]||(a[9]=l=>n.password=l),placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),e(d,{label:"确认密码",prop:"passwordType"},{default:u(()=>[e(t,{type:"password",modelValue:n.passwordType,"onUpdate:modelValue":a[10]||(a[10]=l=>n.passwordType=l),placeholder:"确认密码","show-password":""},null,8,["modelValue"])]),_:1}),e(d,{label:"电话",prop:"phone"},{default:u(()=>[e(t,{modelValue:n.phone,"onUpdate:modelValue":a[11]||(a[11]=l=>n.phone=l),placeholder:"请输入电话号码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Re as default};
