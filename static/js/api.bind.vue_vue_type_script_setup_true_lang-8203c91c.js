import{a as v}from"./index-84988ba2.js";import{d as N,h as u,aI as x,r as y,M as A,o as h,m as w,w as i,f as k,a as n,x as V,N as q,q as M,aS as E,ax as C}from"./index-446ca7c0.js";const D={class:"dialog-footer"},G={name:"roleBindApi"},j=N({...G,props:{modelValue:{type:Boolean,default:!1},role:{type:Object},roles:{type:Array,required:!0}},emits:["update:modelValue"],setup(g,{emit:R}){const s=g,b=u(),l=u(!1),p=u([]),r=u([]);let d=[];function S(a){r.value=a.map(e=>+e.id)}function m(){R("update:modelValue",!1),l.value=!1,r.value=[],d=[]}async function B(){l.value=!0;const{error:a}=await v.mutate({operationName:"System/Role/BindRoleApis",input:{allRoles:s.roles.map(e=>e.code),apis:r.value,roleCode:s.role.code}});a?(C.error("绑定失败"),l.value=!1):(C.success("绑定成功"),m())}return x(async()=>{var a,e;if(s.modelValue&&((a=s.role)!=null&&a.code)){l.value=!0;const o=await v.query({operationName:"System/Operation/GetMany"});if(!o.error){p.value=o.data.data;const{error:c,data:f}=await v.query({operationName:"System/Role/GetRoleBindApis",input:{code:s.role.code}});if(!c){d=((e=f.data)==null?void 0:e.map(t=>t.id))??[],r.value=d;const _=p.value.filter(t=>d.includes(+t.id));for(const t of _)b.value.toggleRowSelection(t,!0)}}l.value=!1}}),(a,e)=>{const o=y("el-table-column"),c=y("el-button"),f=y("el-dialog"),_=A("loading");return h(),w(f,{title:"绑定权限","model-value":g.modelValue,width:"600px","append-to-body":"","onUpdate:modelValue":e[0]||(e[0]=t=>a.$emit("update:modelValue",t)),onClose:m},{footer:i(()=>[k("span",D,[n(c,{onClick:m},{default:i(()=>[V("取消")]),_:1}),n(c,{type:"primary",onClick:B},{default:i(()=>[V("确定")]),_:1})])]),default:i(()=>[q((h(),w(M(E),{data:p.value,ref_key:"tableRef",ref:b,onSelectionChange:S},{default:i(()=>[n(o,{type:"selection",width:"55",align:"center"}),n(o,{label:"路径",prop:"title"}),n(o,{label:"Method",align:"center",prop:"method"}),n(o,{label:"实时查询",align:"center",prop:"liveQuery"})]),_:1},8,["data"])),[[_,l.value]])]),_:1},8,["model-value"])}}});export{j as _};
