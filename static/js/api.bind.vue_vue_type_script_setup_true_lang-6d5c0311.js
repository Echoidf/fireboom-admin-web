import{a as v}from"./index-835b9dae.js";import{d as k,au as x,h as u,aI as A,r as y,M as E,o as S,m as w,w as r,f as M,a as s,x as R,N as q,q as I,aU as O,aY as T,ax as V}from"./index-26a832c3.js";const U={class:"dialog-footer"},D={name:"roleBindApi"},j=k({...D,props:{modelValue:{type:Boolean,default:!1},role:{type:Object},roles:{type:Array,required:!0}},emits:["update:modelValue"],setup(g,{emit:C}){const n=g,b=x(),h=u(),l=u(!1),p=u([]),i=u([]);let c=[];function N(o){i.value=o.map(e=>+e.id)}function m(){C("update:modelValue",!1),l.value=!1,i.value=[],c=[]}async function B(){l.value=!0;const{error:o}=await v.mutate({operationName:"System/Role/BindRoleApis",input:{allRoles:n.roles.map(e=>e.code),apis:i.value,roleCode:n.role.code}});if(o)V.error("绑定失败"),l.value=!1;else{const e=b.roles;T(e).then(a=>{b.SET_PERMISSIONS(a)}),V.success("绑定成功"),m()}}return A(async()=>{var o,e;if(n.modelValue&&((o=n.role)!=null&&o.code)){l.value=!0;const a=await v.query({operationName:"System/Operation/GetMany"});if(!a.error){p.value=a.data.data;const{error:d,data:f}=await v.query({operationName:"System/Role/GetRoleBindApis",input:{code:n.role.code}});if(!d){c=((e=f.data)==null?void 0:e.map(t=>t.id))??[],i.value=c;const _=p.value.filter(t=>c.includes(+t.id));for(const t of _)h.value.toggleRowSelection(t,!0)}}l.value=!1}}),(o,e)=>{const a=y("el-table-column"),d=y("el-button"),f=y("el-dialog"),_=E("loading");return S(),w(f,{title:"绑定权限","model-value":g.modelValue,width:"600px","append-to-body":"","onUpdate:modelValue":e[0]||(e[0]=t=>o.$emit("update:modelValue",t)),onClose:m},{footer:r(()=>[M("span",U,[s(d,{onClick:m},{default:r(()=>[R("取消")]),_:1}),s(d,{type:"primary",onClick:B},{default:r(()=>[R("确定")]),_:1})])]),default:r(()=>[q((S(),w(I(O),{data:p.value,ref_key:"tableRef",ref:h,onSelectionChange:N},{default:r(()=>[s(a,{type:"selection",width:"55",align:"center"}),s(a,{label:"路径",prop:"title"}),s(a,{label:"Method",align:"center",prop:"method"}),s(a,{label:"实时查询",align:"center",prop:"liveQuery"})]),_:1},8,["data"])),[[_,l.value]])]),_:1},8,["model-value"])}}});export{j as _};
