import{a as c}from"./index-84988ba2.js";import{d as S,h as m,aI as N,r as _,M as x,o as g,m as b,w as r,f as I,a as i,x as w,N as U,q as B,aS as q,ax as D}from"./index-446ca7c0.js";const E={class:"dialog-footer"},T=S({__name:"role.bind",props:{modelValue:{type:Boolean,default:!1},user:{type:Object}},emits:["update:modelValue"],setup(v,{emit:C}){const t=v,y=m(),l=m(!1),p=m([]),d=m([]);let n=[];function h(e){d.value=e.map(o=>o.id)}function f(){C("update:modelValue",!1),l.value=!1,d.value=[],n=[]}async function R(){l.value=!0;for(const e of n)await c.mutate({operationName:"System/User/DisconnectRole",input:{userId:t.user.id,roleId:e}});for(const e of d.value)await c.mutate({operationName:"System/User/ConnectRole",input:{userId:t.user.id,roleId:e}});D.success("绑定完成"),f()}return N(async()=>{if(t.modelValue&&t.user){l.value=!0;const e=await c.query({operationName:"System/Role/GetMany"});if(!e.error){p.value=e.data.data;const{error:o,data:s}=await c.query({operationName:"System/User/GetUserRole",input:{userId:t.user.id}});if(!o){n=s.data.map(a=>a.id)||[],d.value=n;const u=p.value.filter(a=>n.includes(a.id));for(const a of u)y.value.toggleRowSelection(a,!0)}}l.value=!1}}),(e,o)=>{const s=_("el-table-column"),u=_("el-button"),a=_("el-dialog"),V=x("loading");return g(),b(a,{title:"绑定角色","model-value":v.modelValue,width:"600px","append-to-body":"","onUpdate:modelValue":o[0]||(o[0]=k=>e.$emit("update:modelValue",k)),onClose:f},{footer:r(()=>[I("span",E,[i(u,{onClick:f},{default:r(()=>[w("取消")]),_:1}),i(u,{type:"primary",onClick:R},{default:r(()=>[w("确定")]),_:1})])]),default:r(()=>[U((g(),b(B(q),{data:p.value,ref_key:"tableRef",ref:y,onSelectionChange:h},{default:r(()=>[i(s,{type:"selection",width:"55",align:"center"}),i(s,{key:"code",label:"Code",align:"center",prop:"code",width:"200"}),i(s,{key:"remark",label:"描述",align:"center",prop:"remark"})]),_:1},8,["data"])),[[V,l.value]])]),_:1},8,["model-value"])}}});export{T as _};
