import{d as O,r as u,a2 as k,o as E,R as D,a as c,k as P,g as R,f as T,i as e,w as i,l as y,aF as s,az as I,b as K,aA as v,aB as x,e as C,m as G,c as Q,aC as $,aI as J}from"./index-d0b35c07.js";import{c as W,e as j,f as H,h as X,i as S,C as Y}from"./system-6b6c2e6e.js";const Z={class:"app-container"},ee={class:"search"},oe=O({name:"UserManage",__name:"index",setup(ae){const z=u(I),h=u(!1),b=u(0);u(!1),u();const f=u();k({visible:!1});const n=k({pageNum:1,pageSize:10,name:"1"}),t=k({ip:"",method:"",path:"",id:""}),w=u([]),m=u([]);async function B(){await W().then(l=>{b.value=l.data.data.logNum._count.id})}async function g(){if(h.value=!0,t.id||t.ip||t.method||t.path)b.value=m.value.length,w.value=m.value.slice((n.pageNum-1)*n.pageSize,n.pageNum*n.pageSize);else{const l=n.pageSize*(n.pageNum-1);await j(l,n.pageSize).then(a=>{w.value=a.data.data.data,m.value.length=0}).catch(a=>{s.error(`获取日志信息失败,错误信息:${a}`)}),B()}h.value=!1}async function _(){h.value=!0;const l={};t.id&&(l.id=t.id),t.ip&&(l.ip=t.ip),t.method&&(l.method=t.method),t.path&&(l.path=t.path),JSON.stringify(l)=="{}"?(n.pageNum=1,g()):await X(l).then(a=>{if(s.success("查询成功"),a.data.data.main_findUniqueapilog){const r=a.data.data.main_findUniqueapilog;m.value=a.data.data.main_findManyapilog.filter(d=>d.id!==r.id),m.value.unshift(r)}else m.value=a.data.data.main_findManyapilog;g()}).catch(a=>{s.error("查询失败")}),h.value=!1}async function U(){await H().then(l=>{f.value=l.data.data.main_findFirstdic.isOpen})}function V(){z.value.resetFields(),n.pageNum=1,t.ip="",t.method="",t.path="",t.id="",g()}function L(l){J.confirm("确定要删除该日志嘛?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Array.isArray(l)?S({equals:l}).then(r=>{s.success("删除成功"),V()}).catch(r=>{s.error("删除失败")}):S({equals:[l]}).then(r=>{s.success("删除成功"),V()}).catch(r=>{s.error("删除失败")})}).catch(()=>{s.info("已取消")})}return E(()=>{B(),g(),U()}),D(f,l=>{const a={set:f.value};Y(a).then(r=>{l?s.success("已开启收集日志"):s.success("已关闭收集日志")})}),(l,a)=>{const r=c("el-input"),d=c("el-form-item"),N=c("el-button"),M=c("el-switch"),p=c("el-table-column"),q=c("el-table"),A=c("el-card"),F=P("loading");return K(),R("div",Z,[T("div",ee,[e(y(I),{ref_key:"queryFormRef",ref:z,model:n,inline:!0},{default:i(()=>[e(d,{label:"IP: ",prop:"ip"},{default:i(()=>[e(r,{modelValue:t.ip,"onUpdate:modelValue":a[0]||(a[0]=o=>t.ip=o),placeholder:"请输入Ip",clearable:"",style:{width:"200px"},onKeyup:v(_,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(d,{label:"Method: ",prop:"method"},{default:i(()=>[e(r,{modelValue:t.method,"onUpdate:modelValue":a[1]||(a[1]=o=>t.method=o),placeholder:"请输入Method",clearable:"",style:{width:"200px"},onKeyup:v(_,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(d,{label:"path: ",prop:"path"},{default:i(()=>[e(r,{modelValue:t.path,"onUpdate:modelValue":a[2]||(a[2]=o=>t.path=o),placeholder:"请输入path",clearable:"",style:{width:"200px"},onKeyup:v(_,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(d,{label:"id: ",prop:"id"},{default:i(()=>[e(r,{modelValue:t.id,"onUpdate:modelValue":a[3]||(a[3]=o=>t.id=o),placeholder:"请输入id",clearable:"",style:{width:"200px"},onKeyup:v(_,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(d,null,{default:i(()=>[e(N,{type:"primary",onClick:_},{default:i(()=>[e(y(x),{icon:"ep:search"}),C("搜索 ")]),_:1}),e(N,{onClick:V},{default:i(()=>[e(y(x),{icon:"ep:refresh"}),C(" 重置 ")]),_:1})]),_:1}),e(d,{label:"开启日志收集"},{default:i(()=>[e(M,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=o=>f.value=o),"inline-prompt":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),e(A,{shadow:"never"},{default:i(()=>[G((K(),Q(q,{data:w.value,"highlight-current-row":"",border:""},{default:i(()=>[e(p,{type:"selection",width:"55"}),e(p,{label:"ID",align:"center",prop:"id",width:"100",sortable:""}),e(p,{label:"用户名",align:"center",prop:"userName",width:"100"}),e(p,{label:"方法",align:"center",prop:"method",width:"100"}),e(p,{label:"ip地址",align:"center",prop:"ip",width:"200"}),e(p,{label:"路径",align:"center",prop:"path",width:"300"}),e(p,{label:"操作时间",align:"center",prop:"updatedAt",width:"200",sortable:""}),e(p,{label:"用户信息",align:"center",prop:"ua",width:"400"}),e(p,{label:"操作",align:"center","min-width":"200"},{default:i(o=>[e(N,{type:"primary",size:"small",link:"",onClick:te=>L(o.row.id)},{default:i(()=>[e(y(x),{icon:"ep:delete"}),C("删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,h.value]]),e(y($),{total:b.value,"current-page":n.pageNum,"onUpdate:currentPage":a[5]||(a[5]=o=>n.pageNum=o),"page-size":n.pageSize,onCurrentChange:g},null,8,["total","current-page","page-size"])]),_:1})])}}});export{oe as default};
