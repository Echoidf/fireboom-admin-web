import{d as Z,h as i,aL as N,aX as ee,$ as x,k as le,r as c,M as ae,o as z,c as te,f as O,a as e,w as a,aM as oe,q as r,aN as p,x as u,N as ne,m as P,aO as ie,y as re,ax as g,aP as se}from"./index-b1c80a62.js";import{a as D,c as ue}from"./index-71ecdb7d.js";import{m as de}from"./index-adf42357.js";import{_ as T}from"./api.bind.vue_vue_type_script_setup_true_lang-474abc11.js";import{_ as K}from"./menu.bind.vue_vue_type_script_setup_true_lang-860d475f.js";const me={class:"app-container"},ce={class:"search"},pe={class:"dialog-footer"},fe={name:"role",components:{RoleBindApi:T,RoleBindMenu:K}},Ve=Z({...fe,name:"RoleManage",setup(ve){const A=i(N),k=i(N);i(ee);const f=i(!1),U=i([]),b=i(0),d=x({pageNum:1,pageSize:10}),V=i([]),v=x({visible:!1}),n=x({code:"",remark:""}),C=i(),L=x({code:[{required:!0,message:"请输入角色编码",trigger:"blur"}]}),M=i(!1),F=i(!1),w=i();async function _(){f.value=!0;const{error:o,data:l}=await D.query({operationName:"System/Role/GetList",input:ue(d,{containsFields:["code","remark"]})});o||(V.value=l.data,b.value=l.total),f.value=!1}function R(){A.value.resetFields(),d.pageNum=1,_()}function Q(o){U.value=o.map(l=>l.id)}function q(o){v.visible=!0,o?(v.title="修改角色",de(n,o),C.value=o.id):v.title="新增角色"}async function I(){k.value.validate(async o=>{if(o){if(f.value=!0,C.value){const{error:l}=await D.mutate({operationName:"System/Role/UpdateOne",input:{id:C.value,remark:n.remark}});l||(g.success("修改成功"),S(),R())}else if(V.value.some(m=>n.code===m.code))g.warning("该角色已存在，请勿重复添加");else{const{error:m}=await D.mutate({operationName:"System/Role/AddOne",input:{...n}});m||(g.success("新增成功"),S(),R())}f.value=!1}})}function S(){v.visible=!1,G()}function G(){k.value.resetFields(),k.value.clearValidate(),n.code="",n.remark=""}function E(o){const l=o?[o]:U;if(!l){g.warning("请勾选删除项");return}se.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{f.value=!0;const{error:m}=await D.mutate({operationName:"System/Role/DeleteMany",input:{ids:l}});m||(g.success("删除成功"),R()),f.value=!1})}function X(o){M.value=!0,w.value=o}function j(o){F.value=!0,w.value=o}return le(()=>{_()}),(o,l)=>{const m=c("el-input"),h=c("el-form-item"),s=c("el-button"),y=c("Auth"),B=c("el-table-column"),H=c("el-table"),J=c("el-card"),W=c("el-dialog"),Y=ae("loading");return z(),te("div",me,[O("div",ce,[e(r(N),{ref_key:"queryFormRef",ref:A,model:d,inline:!0},{default:a(()=>[e(h,{prop:"code",label:"编码"},{default:a(()=>[e(m,{modelValue:d.code,"onUpdate:modelValue":l[0]||(l[0]=t=>d.code=t),placeholder:"角色编码",clearable:"",onKeyup:oe(_,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(h,null,{default:a(()=>[e(s,{type:"primary",onClick:_},{default:a(()=>[e(r(p),{icon:"ep:search"}),u("搜索 ")]),_:1}),e(s,{onClick:R},{default:a(()=>[e(r(p),{icon:"ep:refresh"}),u("重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),e(J,{shadow:"never"},{header:a(()=>[e(y,{value:"/System/Role/AddOne"},{default:a(()=>[e(s,{type:"success",onClick:l[1]||(l[1]=t=>q())},{default:a(()=>[e(r(p),{icon:"ep:plus"}),u("新增 ")]),_:1})]),_:1}),e(y,{value:"/System/Role/DeleteOne"},{default:a(()=>[e(s,{type:"danger",disabled:U.value.length===0,onClick:l[2]||(l[2]=t=>E())},{default:a(()=>[e(r(p),{icon:"ep:delete"}),u("删除 ")]),_:1},8,["disabled"])]),_:1})]),default:a(()=>[ne((z(),P(H,{ref:"dataTableRef",data:V.value,onSelectionChange:Q,"highlight-current-row":"",border:""},{default:a(()=>[e(B,{type:"selection",width:"55",align:"center"}),e(B,{label:"角色编码",prop:"code",width:"200"}),e(B,{label:"角色描述",prop:"remark",width:"300"}),e(B,{fixed:"right",label:"操作"},{default:a(t=>[e(y,{value:"/System/Role/BindRoleApis"},{default:a(()=>[e(s,{type:"primary",size:"small",link:"",onClick:$=>X(t.row)},{default:a(()=>[e(r(p),{icon:"ep:position"}),u("分配权限 ")]),_:2},1032,["onClick"])]),_:2},1024),e(s,{type:"primary",size:"small",link:"",onClick:$=>j(t.row)},{default:a(()=>[e(r(p),{icon:"ep:position"}),u("分配菜单 ")]),_:2},1032,["onClick"]),e(y,{value:"/System/Role/UpdateOne"},{default:a(()=>[e(s,{type:"primary",size:"small",link:"",onClick:$=>q(t.row)},{default:a(()=>[e(r(p),{icon:"ep:edit"}),u("编辑 ")]),_:2},1032,["onClick"])]),_:2},1024),e(y,{value:"/System/Role/DeleteMany"},{default:a(()=>[e(s,{type:"primary",size:"small",link:"",onClick:$=>E(t.row.id)},{default:a(()=>[e(r(p),{icon:"ep:delete"}),u("删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Y,f.value]]),b.value>0?(z(),P(r(ie),{key:0,total:b.value,"onUpdate:total":l[3]||(l[3]=t=>b.value=t),"current-page":d.pageNum,"onUpdate:currentPage":l[4]||(l[4]=t=>d.pageNum=t),limit:d.pageSize,"onUpdate:limit":l[5]||(l[5]=t=>d.pageSize=t),onCurrentChange:_},null,8,["total","current-page","limit"])):re("",!0)]),_:1}),e(W,{title:v.title,modelValue:v.visible,"onUpdate:modelValue":l[8]||(l[8]=t=>v.visible=t),width:"500px",onClose:S},{footer:a(()=>[O("div",pe,[e(s,{type:"primary",onClick:I},{default:a(()=>[u("确 定")]),_:1}),e(s,{onClick:S},{default:a(()=>[u("取 消")]),_:1})])]),default:a(()=>[e(r(N),{ref_key:"roleFormRef",ref:k,model:n,rules:L,"label-width":"100px"},{default:a(()=>[e(h,{label:"角色编码",prop:"code"},{default:a(()=>[e(m,{modelValue:n.code,"onUpdate:modelValue":l[6]||(l[6]=t=>n.code=t),readonly:!!C.value,placeholder:"请输入角色编码"},null,8,["modelValue","readonly"])]),_:1}),e(h,{label:"角色描述",prop:"remark"},{default:a(()=>[e(m,{modelValue:n.remark,"onUpdate:modelValue":l[7]||(l[7]=t=>n.remark=t),placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(T,{modelValue:M.value,"onUpdate:modelValue":l[9]||(l[9]=t=>M.value=t),role:w.value,roles:V.value},null,8,["modelValue","role","roles"]),e(K,{modelValue:F.value,"onUpdate:modelValue":l[10]||(l[10]=t=>F.value=t),role:w.value},null,8,["modelValue","role"])])}}});export{Ve as default};
