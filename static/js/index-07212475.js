import{d as ee,h as i,aK as B,aV as le,$ as S,k as ae,r as f,M as oe,o as v,c as te,f as K,a as l,w as o,aL as ne,q as n,aM as m,x as u,aW as E,m as g,y as x,N as ie,aN as re,ax as D,aO as se}from"./index-3273f717.js";import{a as U,c as ue}from"./index-02179bb8.js";import{m as de}from"./index-adf42357.js";import{_ as P}from"./api.bind.vue_vue_type_script_setup_true_lang-dc90d0d4.js";import{_ as L}from"./menu.bind.vue_vue_type_script_setup_true_lang-7f11a5f0.js";const me={class:"app-container"},pe={class:"search"},ce={class:"dialog-footer"},fe={name:"role",components:{RoleBindApi:P,RoleBindMenu:L}},Ve=ee({...fe,name:"RoleManage",setup(ve){const O=i(B),k=i(B);i(le);const p=i(!1),F=i([]),b=i(0),d=S({pageNum:1,pageSize:10}),M=i([]),c=S({visible:!1}),r=S({code:"",remark:""}),V=i(),Q=S({code:[{required:!0,message:"请输入角色编码",trigger:"blur"}]}),$=i(!1),z=i(!1),w=i();async function y(){p.value=!0;const{error:t,data:e}=await U.query({operationName:"System/Role/GetList",input:ue(d,{containsFields:["code","remark"]})});t||(M.value=e.data,b.value=e.total),p.value=!1}function C(){O.value.resetFields(),d.pageNum=1,y()}function I(t){F.value=t.map(e=>e.id)}function A(t){c.visible=!0,t?(c.title="修改角色",de(r,t),V.value=t.id):c.title="新增角色"}async function G(){p.value=!0,k.value.validate(async t=>{if(t){if(V.value){const{error:e}=await U.mutate({operationName:"System/Role/UpdateOne",input:{id:V.value,remark:r.remark}});e||(D.success("修改成功"),R(),C())}else{const{error:e}=await U.mutate({operationName:"System/Role/AddOne",input:{...r}});e||(D.success("新增成功"),R(),C())}p.value=!1}})}function R(){c.visible=!1,W()}function W(){k.value.resetFields(),k.value.clearValidate(),r.code="",r.remark=""}function T(t){const e=t?[t]:F;if(!e){D.warning("请勾选删除项");return}se.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{p.value=!0;const{error:_}=await U.mutate({operationName:"System/Role/DeleteMany",input:{ids:e}});_||(D.success("删除成功"),C()),p.value=!1})}function j(t){$.value=!0,w.value=t}function H(t){z.value=!0,w.value=t}return ae(()=>{y()}),(t,e)=>{const _=f("el-input"),N=f("el-form-item"),s=f("el-button"),h=f("el-table-column"),J=f("el-table"),X=f("el-card"),Y=f("el-dialog"),Z=oe("loading");return v(),te("div",me,[K("div",pe,[l(n(B),{ref_key:"queryFormRef",ref:O,model:d,inline:!0},{default:o(()=>[l(N,{prop:"code",label:"编码"},{default:o(()=>[l(_,{modelValue:d.code,"onUpdate:modelValue":e[0]||(e[0]=a=>d.code=a),placeholder:"角色编码",clearable:"",onKeyup:ne(y,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(N,null,{default:o(()=>[l(s,{type:"primary",onClick:y},{default:o(()=>[l(n(m),{icon:"ep:search"}),u("搜索 ")]),_:1}),l(s,{onClick:C},{default:o(()=>[l(n(m),{icon:"ep:refresh"}),u("重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),l(X,{shadow:"never"},{header:o(()=>[n(E)("/System/Role/AddOne")?(v(),g(s,{key:0,type:"success",onClick:e[1]||(e[1]=a=>A())},{default:o(()=>[l(n(m),{icon:"ep:plus"}),u("新增 ")]),_:1})):x("",!0),n(E)("/System/Role/DeleteOne")?(v(),g(s,{key:1,type:"danger",disabled:F.value.length===0,onClick:e[2]||(e[2]=a=>T())},{default:o(()=>[l(n(m),{icon:"ep:delete"}),u("删除 ")]),_:1},8,["disabled"])):x("",!0)]),default:o(()=>[ie((v(),g(J,{ref:"dataTableRef",data:M.value,onSelectionChange:I,"highlight-current-row":"",border:""},{default:o(()=>[l(h,{type:"selection",width:"55",align:"center"}),l(h,{label:"角色编码",prop:"code",width:"200"}),l(h,{label:"角色描述",prop:"remark",width:"300"}),l(h,{fixed:"right",label:"操作"},{default:o(a=>[n(E)("/System/Role/DeleteOne")?(v(),g(s,{key:0,type:"primary",size:"small",link:"",onClick:q=>j(a.row)},{default:o(()=>[l(n(m),{icon:"ep:position"}),u("分配权限 ")]),_:2},1032,["onClick"])):x("",!0),l(s,{type:"primary",size:"small",link:"",onClick:q=>H(a.row)},{default:o(()=>[l(n(m),{icon:"ep:position"}),u("分配菜单 ")]),_:2},1032,["onClick"]),l(s,{type:"primary",size:"small",link:"",onClick:q=>A(a.row)},{default:o(()=>[l(n(m),{icon:"ep:edit"}),u("编辑 ")]),_:2},1032,["onClick"]),l(s,{type:"primary",size:"small",link:"",onClick:q=>T(a.row.id)},{default:o(()=>[l(n(m),{icon:"ep:delete"}),u("删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,p.value]]),b.value>0?(v(),g(n(re),{key:0,total:b.value,"onUpdate:total":e[3]||(e[3]=a=>b.value=a),page:d.pageNum,"onUpdate:page":e[4]||(e[4]=a=>d.pageNum=a),limit:d.pageSize,"onUpdate:limit":e[5]||(e[5]=a=>d.pageSize=a),onPagination:y},null,8,["total","page","limit"])):x("",!0)]),_:1}),l(Y,{title:c.title,modelValue:c.visible,"onUpdate:modelValue":e[8]||(e[8]=a=>c.visible=a),width:"500px",onClose:R},{footer:o(()=>[K("div",ce,[l(s,{type:"primary",onClick:G},{default:o(()=>[u("确 定")]),_:1}),l(s,{onClick:R},{default:o(()=>[u("取 消")]),_:1})])]),default:o(()=>[l(n(B),{ref_key:"roleFormRef",ref:k,model:r,rules:Q,"label-width":"100px"},{default:o(()=>[l(N,{label:"角色编码",prop:"code"},{default:o(()=>[l(_,{modelValue:r.code,"onUpdate:modelValue":e[6]||(e[6]=a=>r.code=a),readonly:!!V.value,placeholder:"请输入角色编码"},null,8,["modelValue","readonly"])]),_:1}),l(N,{label:"角色描述",prop:"remark"},{default:o(()=>[l(_,{modelValue:r.remark,"onUpdate:modelValue":e[7]||(e[7]=a=>r.remark=a),placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(P,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=a=>$.value=a),role:w.value,roles:M.value},null,8,["modelValue","role","roles"]),l(L,{modelValue:z.value,"onUpdate:modelValue":e[10]||(e[10]=a=>z.value=a),role:w.value},null,8,["modelValue","role"])])}}});export{Ve as default};
