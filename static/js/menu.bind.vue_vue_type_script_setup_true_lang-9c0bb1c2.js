import{a as c}from"./index-26815c4e.js";import{d as S,h as m,aI as x,r as y,M as B,o as w,m as h,w as i,f as R,a as u,x as M,N as k,q as I,aU as q,ax as D}from"./index-27234e3d.js";const E={class:"dialog-footer"},O={name:"roleBindMenu"},U=S({...O,props:{modelValue:{type:Boolean,default:!1},role:{type:Object}},emits:["update:modelValue"],setup(g,{emit:V}){const n=g,b=m(),o=m(!1),p=m([]),r=m([]);let s=[];function C(e){r.value=e.map(a=>a.id)}function f(){V("update:modelValue",!1),o.value=!1,r.value=[],s=[]}async function N(){o.value=!0;for(const e of s)await c.mutate({operationName:"System/Role/DisconnectOneMenu",input:{id:n.role.id,menuId:e}});for(const e of r.value)await c.mutate({operationName:"System/Role/ConnectOneMenu",input:{id:n.role.id,menuId:e}});f(),D.success("绑定成功"),o.value=!1}return x(async()=>{var e,a;if(n.modelValue&&((e=n.role)!=null&&e.code)){o.value=!0;const l=await c.query({operationName:"System/Menu/GetMany",input:{in:[1,2]}});if(!l.error){p.value=l.data.data;const{error:d,data:_}=await c.query({operationName:"System/Role/GetBindMenus",input:{roleId:n.role.id}});if(!d){s=((a=_.data)==null?void 0:a.map(t=>t.id))??[],r.value=s;const v=p.value.filter(t=>s.includes(t.id));for(const t of v)b.value.toggleRowSelection(t,!0)}}o.value=!1}}),(e,a)=>{const l=y("el-table-column"),d=y("el-button"),_=y("el-dialog"),v=B("loading");return w(),h(_,{title:"绑定菜单","model-value":g.modelValue,width:"600px","append-to-body":"","onUpdate:modelValue":a[0]||(a[0]=t=>e.$emit("update:modelValue",t)),onClose:f},{footer:i(()=>[R("span",E,[u(d,{onClick:f},{default:i(()=>[M("取消")]),_:1}),u(d,{type:"primary",onClick:N},{default:i(()=>[M("确定")]),_:1})])]),default:i(()=>[k((w(),h(I(q),{data:p.value,ref_key:"tableRef",ref:b,onSelectionChange:C},{default:i(()=>[u(l,{type:"selection",width:"55",align:"center"}),u(l,{label:"名称",prop:"label"}),u(l,{label:"路径",align:"center",prop:"path"})]),_:1},8,["data"])),[[v,o.value]])]),_:1},8,["model-value"])}}});export{U as _};
