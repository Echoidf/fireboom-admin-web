import{d as P,aC as te,r as s,au as H,a as g,k as Q,c as A,w as l,b as x,f as T,i as e,e as y,m as K,l as w,aG as L,aB as M,a0 as z,o as oe,g as ne,ax as I,aH as ie,ay as se,az as N,aA as ue,D as re,aD as de}from"./index-f5c5fa2d.js";import{a as C,c as ce}from"./index-b3874aa8.js";import{m as me}from"./index-adf42357.js";import{b as pe}from"./system-4c1accdc.js";const fe={class:"dialog-footer"},ve={name:"roleBindApi"},_e=P({...ve,props:{modelValue:{type:Boolean,default:!1},role:{type:Object},roles:{type:Array,required:!0}},emits:["update:modelValue"],setup(D,{emit:U}){const d=D,b=te(),k=s(),m=s(!1),u=s([]),p=s([]);let f=[];function c(n){p.value=n.map(o=>+o.id)}function R(){U("update:modelValue",!1),m.value=!1,p.value=[],f=[]}async function v(){m.value=!0;const{error:n}=await C.mutate({operationName:"System/Role/BindRoleApis",input:{allRoles:d.roles.map(o=>o.code),apis:p.value,roleCode:d.role.code}});if(n)M.error("绑定失败"),m.value=!1;else{const o=b.roles;pe(o).then(i=>{b.SET_PERMISSIONS(i)}),M.success("绑定成功"),R()}}return H(async()=>{var n,o;if(d.modelValue&&((n=d.role)!=null&&n.code)){m.value=!0;const i=await C.query({operationName:"System/Operation/GetMany"});if(!i.error){u.value=i.data.data;const{error:_,data:S}=await C.query({operationName:"System/Role/GetRoleBindApis",input:{code:d.role.code}});if(!_){f=((o=S.data)==null?void 0:o.map(h=>h.id))??[],p.value=f;const V=u.value.filter(h=>f.includes(+h.id));for(const h of V)k.value.toggleRowSelection(h,!0)}}m.value=!1}}),(n,o)=>{const i=g("el-table-column"),_=g("el-button"),S=g("el-dialog"),V=Q("loading");return x(),A(S,{title:"绑定权限","model-value":D.modelValue,width:"600px","append-to-body":"","onUpdate:modelValue":o[0]||(o[0]=h=>n.$emit("update:modelValue",h)),onClose:R},{footer:l(()=>[T("span",fe,[e(_,{onClick:R},{default:l(()=>[y("取消")]),_:1}),e(_,{type:"primary",onClick:v},{default:l(()=>[y("确定")]),_:1})])]),default:l(()=>[K((x(),A(w(L),{data:u.value,ref_key:"tableRef",ref:k,onSelectionChange:c},{default:l(()=>[e(i,{type:"selection",width:"55",align:"center"}),e(i,{label:"路径",prop:"title"}),e(i,{label:"Method",align:"center",prop:"method"}),e(i,{label:"实时查询",align:"center",prop:"liveQuery"})]),_:1},8,["data"])),[[V,m.value]])]),_:1},8,["model-value"])}}}),ye={class:"dialog-footer"},ge={name:"roleBindMenu"},be=P({...ge,props:{modelValue:{type:Boolean,default:!1},role:{type:Object}},emits:["update:modelValue"],setup(D,{emit:U}){const d=D,b=s(),k=s(!1),m=s([]),u=s([]);let p=[];function f(v){u.value=v.map(n=>n.id)}function c(){U("update:modelValue",!1),k.value=!1,u.value=[],p=[]}async function R(){k.value=!0;for(const v of p)await C.mutate({operationName:"System/Role/DisconnectOneMenu",input:{id:d.role.id,menuId:v}});for(const v of u.value)await C.mutate({operationName:"System/Role/ConnectOneMenu",input:{id:d.role.id,menuId:v}});c(),M.success("绑定成功"),k.value=!1}return H(async()=>{var v,n;if(d.modelValue&&((v=d.role)!=null&&v.code)){k.value=!0;const o=await C.query({operationName:"System/Menu/GetMany",input:{in:[1,2]}});if(!o.error){m.value=o.data.data;const{error:i,data:_}=await C.query({operationName:"System/Role/GetBindMenus",input:{roleId:d.role.id}});if(!i){p=((n=_.data)==null?void 0:n.map(V=>V.id))??[],u.value=p;const S=m.value.filter(V=>p.includes(V.id));for(const V of S)b.value.toggleRowSelection(V,!0)}}k.value=!1}}),(v,n)=>{const o=g("el-table-column"),i=g("el-button"),_=g("el-dialog"),S=Q("loading");return x(),A(_,{title:"绑定菜单","model-value":D.modelValue,width:"600px","append-to-body":"","onUpdate:modelValue":n[0]||(n[0]=V=>v.$emit("update:modelValue",V)),onClose:c},{footer:l(()=>[T("span",ye,[e(i,{onClick:c},{default:l(()=>[y("取消")]),_:1}),e(i,{type:"primary",onClick:R},{default:l(()=>[y("确定")]),_:1})])]),default:l(()=>[K((x(),A(w(L),{data:m.value,ref_key:"tableRef",ref:b,onSelectionChange:f},{default:l(()=>[e(o,{type:"selection",width:"55",align:"center"}),e(o,{label:"名称",prop:"label"}),e(o,{label:"路径",align:"center",prop:"path"})]),_:1},8,["data"])),[[S,k.value]])]),_:1},8,["model-value"])}}}),ke={class:"app-container"},Ve={class:"search"},we={class:"dialog-footer"},Be=P({name:"RoleManage",__name:"index",setup(D){const U=s(I),d=s(I);s(ie);const b=s(!1),k=s([]),m=s(0),u=z({pageNum:1,pageSize:10}),p=s([]),f=z({visible:!1}),c=z({code:"",remark:""}),R=s(),v=z({code:[{required:!0,message:"请输入角色编码",trigger:"blur"}]}),n=s(!1),o=s(!1),i=s();async function _(){b.value=!0;const{error:r,data:a}=await C.query({operationName:"System/Role/GetList",input:ce(u,{containsFields:["code","remark"]})});r||(p.value=a.data,m.value=a.total),b.value=!1}function S(){U.value.resetFields(),u.pageNum=1,_()}function V(r){k.value=r.map(a=>a.id)}function h(r){f.visible=!0,r?(f.title="修改角色",me(c,r),R.value=r.id):f.title="新增角色"}async function J(){b.value=!0,d.value.validate(async r=>{if(r){if(R.value){const{error:a}=await C.mutate({operationName:"System/Role/UpdateOne",input:{id:R.value,remark:c.remark}});a||(M.success("修改成功"),q(),S())}else{const{error:a}=await C.mutate({operationName:"System/Role/AddOne",input:{...c}});a||(M.success("新增成功"),q(),S())}b.value=!1}})}function q(){f.visible=!1,W()}function W(){d.value.resetFields(),d.value.clearValidate(),c.code="",c.remark=""}function j(r){const a=r?[r]:k;if(!a){M.warning("请勾选删除项");return}de.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{b.value=!0;const{error:$}=await C.mutate({operationName:"System/Role/DeleteMany",input:{ids:a}});$||(M.success("删除成功"),S()),b.value=!1})}function X(r){n.value=!0,i.value=r}function Y(r){o.value=!0,i.value=r}return oe(()=>{_()}),(r,a)=>{const $=g("el-input"),E=g("el-form-item"),B=g("el-button"),O=g("Auth"),F=g("el-table-column"),Z=g("el-table"),ee=g("el-card"),le=g("el-dialog"),ae=Q("loading");return x(),ne("div",ke,[T("div",Ve,[e(w(I),{ref_key:"queryFormRef",ref:U,model:u,inline:!0},{default:l(()=>[e(E,{prop:"code",label:"编码"},{default:l(()=>[e($,{modelValue:u.code,"onUpdate:modelValue":a[0]||(a[0]=t=>u.code=t),placeholder:"角色编码",clearable:"",onKeyup:se(_,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(E,null,{default:l(()=>[e(B,{type:"primary",onClick:_},{default:l(()=>[e(w(N),{icon:"ep:search"}),y("搜索 ")]),_:1}),e(B,{onClick:S},{default:l(()=>[e(w(N),{icon:"ep:refresh"}),y("重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),e(ee,{shadow:"never"},{header:l(()=>[e(O,{value:"/System/Role/AddOne"},{default:l(()=>[e(B,{type:"success",onClick:a[1]||(a[1]=t=>h())},{default:l(()=>[e(w(N),{icon:"ep:plus"}),y("新增 ")]),_:1})]),_:1}),e(O,{value:"/System/Role/DeleteOne"},{default:l(()=>[e(B,{type:"danger",disabled:k.value.length===0,onClick:a[2]||(a[2]=t=>j())},{default:l(()=>[e(w(N),{icon:"ep:delete"}),y("删除 ")]),_:1},8,["disabled"])]),_:1})]),default:l(()=>[K((x(),A(Z,{ref:"dataTableRef",data:p.value,onSelectionChange:V,"highlight-current-row":"",border:""},{default:l(()=>[e(F,{type:"selection",width:"55",align:"center"}),e(F,{label:"角色编码",prop:"code",width:"200"}),e(F,{label:"角色描述",prop:"remark",width:"300"}),e(F,{fixed:"right",label:"操作"},{default:l(t=>[e(O,{value:"/System/Role/BindRoleApis"},{default:l(()=>[e(B,{type:"primary",size:"small",link:"",onClick:G=>X(t.row)},{default:l(()=>[e(w(N),{icon:"ep:position"}),y("分配权限 ")]),_:2},1032,["onClick"])]),_:2},1024),e(B,{type:"primary",size:"small",link:"",onClick:G=>Y(t.row)},{default:l(()=>[e(w(N),{icon:"ep:position"}),y("分配菜单 ")]),_:2},1032,["onClick"]),e(O,{value:"/System/Role/UpdateOne"},{default:l(()=>[e(B,{type:"primary",size:"small",link:"",onClick:G=>h(t.row)},{default:l(()=>[e(w(N),{icon:"ep:edit"}),y("编辑 ")]),_:2},1032,["onClick"])]),_:2},1024),e(O,{value:"/System/Role/DeleteMany"},{default:l(()=>[e(B,{type:"primary",size:"small",link:"",onClick:G=>j(t.row.id)},{default:l(()=>[e(w(N),{icon:"ep:delete"}),y("删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ae,b.value]]),m.value>0?(x(),A(w(ue),{key:0,total:m.value,"onUpdate:total":a[3]||(a[3]=t=>m.value=t),page:u.pageNum,"onUpdate:page":a[4]||(a[4]=t=>u.pageNum=t),limit:u.pageSize,"onUpdate:limit":a[5]||(a[5]=t=>u.pageSize=t),onPagination:_},null,8,["total","page","limit"])):re("",!0)]),_:1}),e(le,{title:f.title,modelValue:f.visible,"onUpdate:modelValue":a[8]||(a[8]=t=>f.visible=t),width:"500px",onClose:q},{footer:l(()=>[T("div",we,[e(B,{type:"primary",onClick:J},{default:l(()=>[y("确 定")]),_:1}),e(B,{onClick:q},{default:l(()=>[y("取 消")]),_:1})])]),default:l(()=>[e(w(I),{ref_key:"roleFormRef",ref:d,model:c,rules:v,"label-width":"100px"},{default:l(()=>[e(E,{label:"角色编码",prop:"code"},{default:l(()=>[e($,{modelValue:c.code,"onUpdate:modelValue":a[6]||(a[6]=t=>c.code=t),readonly:!!R.value,placeholder:"请输入角色编码"},null,8,["modelValue","readonly"])]),_:1}),e(E,{label:"角色描述",prop:"remark"},{default:l(()=>[e($,{modelValue:c.remark,"onUpdate:modelValue":a[7]||(a[7]=t=>c.remark=t),placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(_e,{modelValue:n.value,"onUpdate:modelValue":a[9]||(a[9]=t=>n.value=t),role:i.value,roles:p.value},null,8,["modelValue","role","roles"]),e(be,{modelValue:o.value,"onUpdate:modelValue":a[10]||(a[10]=t=>o.value=t),role:i.value},null,8,["modelValue","role"])])}}});export{Be as default};
