import{d as z,r as s,au as M,a as r,k as B,c as R,w as a,b as C,f as E,i as e,e as h,m as G,l as b,aG as P,aB as $,a0 as K,o as Q,g as T,ax as x,ay as j,az as q,aA as O}from"./index-986fbe68.js";import{a as w,c as H}from"./index-547e77c2.js";const J={class:"dialog-footer"},W=z({__name:"role.bind",props:{modelValue:{type:Boolean,default:!1},user:{type:Object}},emits:["update:modelValue"],setup(S,{emit:k}){const i=S,g=s(),u=s(!1),v=s([]),l=s([]);let d=[];function m(t){l.value=t.map(o=>o.id)}function y(){k("update:modelValue",!1),u.value=!1,l.value=[],d=[]}async function U(){u.value=!0;for(const t of d)await w.mutate({operationName:"System/User/DisconnectRole",input:{userId:i.user.id,roleId:t}});for(const t of l.value)await w.mutate({operationName:"System/User/ConnectRole",input:{userId:i.user.id,roleId:t}});$.success("绑定完成"),y()}return M(async()=>{if(i.modelValue&&i.user){u.value=!0;const t=await w.query({operationName:"System/Role/GetMany"});if(!t.error){v.value=t.data.data;const{error:o,data:p}=await w.query({operationName:"System/User/GetUserRole",input:{userId:i.user.id}});if(!o){d=p.data.map(n=>n.id)||[],l.value=d;const f=v.value.filter(n=>d.includes(n.id));for(const n of f)g.value.toggleRowSelection(n,!0)}}u.value=!1}}),(t,o)=>{const p=r("el-table-column"),f=r("el-button"),n=r("el-dialog"),V=B("loading");return C(),R(n,{title:"绑定角色","model-value":S.modelValue,width:"600px","append-to-body":"","onUpdate:modelValue":o[0]||(o[0]=_=>t.$emit("update:modelValue",_)),onClose:y},{footer:a(()=>[E("span",J,[e(f,{onClick:y},{default:a(()=>[h("取消")]),_:1}),e(f,{type:"primary",onClick:U},{default:a(()=>[h("确定")]),_:1})])]),default:a(()=>[G((C(),R(b(P),{data:v.value,ref_key:"tableRef",ref:g,onSelectionChange:m},{default:a(()=>[e(p,{type:"selection",width:"55",align:"center"}),e(p,{key:"code",label:"Code",align:"center",prop:"code",width:"200"}),e(p,{key:"remark",label:"描述",align:"center",prop:"remark"})]),_:1},8,["data"])),[[V,u.value]])]),_:1},8,["model-value"])}}}),X={class:"app-container"},Y={class:"search"},ae=z({name:"UserManage",__name:"index",setup(S){const k=s(x),i=s(!1),g=s(0),u=s(!1),v=s(),l=K({pageNum:1,pageSize:10,name:""}),d=s([]);async function m(){i.value=!0;const{error:t,data:o}=await w.query({operationName:"System/User/GetList",input:H(l,{containsFields:["name"]})});t||(d.value=o.data,g.value=o.data.length),i.value=!1}function y(){k.value.resetFields(),l.pageNum=1,m()}function U(t){u.value=!0,v.value=t}return Q(()=>{m()}),(t,o)=>{const p=r("el-input"),f=r("el-form-item"),n=r("el-button"),V=r("Auth"),_=r("el-table-column"),I=r("el-image"),D=r("el-table"),F=r("el-card"),L=B("loading");return C(),T("div",X,[E("div",Y,[e(b(x),{ref_key:"queryFormRef",ref:k,model:l,inline:!0},{default:a(()=>[e(f,{label:"名称",prop:"name"},{default:a(()=>[e(p,{modelValue:l.name,"onUpdate:modelValue":o[0]||(o[0]=c=>l.name=c),placeholder:"用户名",clearable:"",style:{width:"200px"},onKeyup:j(m,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(f,null,{default:a(()=>[e(V,{value:"/System/User/GetList"},{default:a(()=>[e(n,{type:"primary",onClick:m},{default:a(()=>[e(b(q),{icon:"ep:search"}),h("搜索 ")]),_:1})]),_:1}),e(V,{value:"/System/User/GetList"},{default:a(()=>[e(n,{onClick:y},{default:a(()=>[e(b(q),{icon:"ep:refresh"}),h(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),e(F,{shadow:"never"},{default:a(()=>[G((C(),R(D,{data:d.value,"highlight-current-row":"",border:""},{default:a(()=>[e(_,{key:"id",label:"编号",align:"center",prop:"id",width:"100"}),e(_,{key:"name",label:"用户名",align:"center",prop:"name",width:"200"}),e(_,{label:"头像",width:"80",align:"center",prop:"avatar"},{default:a(c=>[e(I,{src:c.row.avatar,"preview-src-list":[c.row.avatar]},null,8,["src","preview-src-list"])]),_:1}),e(_,{label:"创建时间",align:"center",prop:"createdAt",width:"180",formatter:(c,A,N)=>N?new Date(N).toLocaleDateString():""},null,8,["formatter"]),e(_,{label:"操作",fixed:"right","min-width":"220"},{default:a(c=>[e(n,{type:"primary",size:"small",link:"",onClick:A=>U(c.row)},{default:a(()=>[h("绑定角色")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,i.value]]),e(b(O),{total:g.value,"page-count":l.pageNum,"page-size":l.pageSize,onPagination:m},null,8,["total","page-count","page-size"])]),_:1}),e(W,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=c=>u.value=c),user:v.value},null,8,["modelValue","user"])])}}});export{ae as default};
